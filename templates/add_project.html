{% extends 'base.html' %}
{% block title %}Dodaj projekt ‚Äî BaluxStal{% endblock %}

{% block content %}
<section class="admin-section">
    <div class="admin-inner" style="max-width:800px">
        <div class="admin-header">
            <h1>Nowy <span>Projekt</span></h1>
            <a href="{{ url_for('admin') }}" class="btn-secondary">‚Üê Wr√≥ƒá</a>
        </div>

        <form class="project-form" method="POST" enctype="multipart/form-data">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="form-grid">
                <div class="form-group">
                    <label>Tytu≈Ç projektu *</label>
                    <input type="text" name="title" placeholder="np. Schody dworkowe z kutym motywem" required>
                </div>
                <div class="form-group">
                    <label>Kategoria *</label>
                    <select name="category" required>
                        <option value="">Wybierz kategoriƒô</option>
                        {% for cat in categories %}
                        <option value="{{ cat }}">{{ cat }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Lokalizacja</label>
                    <input type="text" name="location" placeholder="np. Krak√≥w">
                </div>
                <div class="form-group">
                    <label>Rok realizacji</label>
                    <input type="text" name="year" placeholder="np. 2024">
                </div>
            </div>

            <div class="form-group">
                <label>Opis projektu</label>
                <textarea name="description" rows="5" placeholder="Opisz projekt ‚Äî materia≈Çy, techniki, szczeg√≥≈Çy realizacji..."></textarea>
            </div>

            <div class="form-group">
                <label>Zdjƒôcia</label>
                <div class="upload-zone" id="uploadZone">
                    <input type="file" name="images" id="imageInput" multiple 
                           accept=".jpg,.jpeg,.png,.gif,.webp" onchange="previewImages(this)">
                    <div class="upload-hint">
                        <span class="upload-icon">üì∑</span>
                        <p>Kliknij lub przeciƒÖgnij zdjƒôcia tutaj</p>
                        <p class="upload-sub">JPG, PNG, WebP ‚Äî mo≈ºesz wybraƒá wiele plik√≥w</p>
                    </div>
                </div>
                <div class="preview-grid" id="previewGrid"></div>
            </div>

            <div class="form-actions">
                <a href="{{ url_for('admin') }}" class="btn-secondary">Anuluj</a>
                <button type="submit" class="btn-primary">Zapisz projekt ‚úì</button>
            </div>
        </form>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
function previewImages(input) {
    const grid = document.getElementById('previewGrid');
    grid.innerHTML = '';
    Array.from(input.files).forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
            const div = document.createElement('div');
            div.className = 'preview-item';
            div.innerHTML = `<img src="${e.target.result}" alt=""><span>${file.name}</span>`;
            grid.appendChild(div);
        };
        reader.readAsDataURL(file);
    });
}

// Drag & drop
const zone = document.getElementById('uploadZone');
zone.addEventListener('dragover', e => { e.preventDefault(); zone.classList.add('drag-over'); });
zone.addEventListener('dragleave', () => zone.classList.remove('drag-over'));
zone.addEventListener('drop', e => {
    e.preventDefault();
    zone.classList.remove('drag-over');
    const input = document.getElementById('imageInput');
    input.files = e.dataTransfer.files;
    previewImages(input);
});
</script>
{% endblock %}
